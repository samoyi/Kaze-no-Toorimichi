# 主题与条目的相关算法


## 实现功能
### 编辑
* 添加主题
* 删除主题
* 修改主题
    * 修改主题名称
    * 修改主题在树中的位置
    * 修改主题内部信息
* 添加条目
* 删除条目
* 修改条目
    * 修改条目的大类和子类

### 搜索
* 搜索主题
* 搜索条目
* 搜索结果排序

### 推荐
* 相关主题



## 算法逻辑
### 主题路径根据主题ID树的变化动态更新
1. 主题ID树如果发生变化，除了在枝末端添加新主题的情况下，都需要更改已有的主题路径
2. 因此需要对【主题ID——主题路径】映射数组、【条目ID——主题路径】对象和【主题路径——条目
ID】Map进行更新
3. 【主题ID——主题路径】映射数组可以直接遍历主题ID树整体重新生成新的数据结构，但另外两个
数据结构并不能整体重新生成。
4. 难道需要遍历每个主题路径，找到相关的路径并逐个更新。能不能让主题路径数组成为动态的，
而不是像现在这样是固定的几个数字组成的数组。


### 编辑
#### 添加主题
1. 确定新添加的主题名不存在于现有主题系统中
2. 为该新主题至少添加一个主题路径（见下面的“添加主题路径”）
3. 将新添加的若干主题路径组成的数组push到【主题ID——主题路径】映射数组
4. 在【主题路径——条目ID】Map中，分别将以上若干新添加的主题路径作为键，值为空数组
5. 将新添加的主题名push到【主题ID——主题名】映射数组
6. 根据主题信息组建主题对象，push到【主题ID——主题对象】映射数组
7. 在【主题ID树】对象中加入该主题ID（见下面的“修改主题ID树”）

#### 删除主题
1. 从【主题ID——主题名】映射数组直接移除
2. 从【主题ID——主题对象】映射数组直接移除
3. 从【主题ID树】对象中移除主题节点（见下面的“修改主题ID树”）
4. 从【主题ID——主题路径】映射数组直接移除，并记录相应主题路径
5. 在【主题路径——条目ID】Map中根据上一步记录的主题路径，删除相应记录
【条目ID——主题路径】对象

### 主题搜索
1. 输入一个主题名，在【主题ID——主题名】映射数组中找到对应的主题ID
2. 根据该主题ID，在【主题ID——主题路径】映射数组中找到该主题的若干主题路径数组
3. 在【主题路径——条目ID】映射中找到上述主题路径对应的的条目ID



### 添加主题路径
1. 将新建主题添加到【主题树】对象的合理位置上
2. 根据添加的位置获取主题路径数组，添加到【主题ID——主题路径】映射数组

### 修改主题ID树
#### 添加
##### 添加到枝末端
##### 添加到枝中间

#### 删除
##### 删除枝末端节点
##### 删除枝中间节点

#### 移动位置
##### 移动枝末端节点
##### 移动枝中间节点




### 修改主题名
1. 修改【主题树】对象中该主题ID对应的主题名
2. 【主题ID——主题名】映射数组中，获取主题ID并修改主题名

### 删除主题路径
1. 在主题数中删除该主题，并将被删除主题的子主题作为被删除主题父主题的子主题（爷孙变父子）
2. 在【主题ID——主题路径】映射数组中删除该主题路径
3. 在【主题路径——条目ID】Map中删除对应的路径和条目
4. 如果删除的是该主题的最后一条主题路径，则触发删除主题操作。见下文。

### 修改主题路径
1. 删除主题路径
2. 添加主题路径



### 删除主题
1. 当删除最后一条该主题的主题路径后，【主题树】对象和【主题路径——条目ID】Map中已经没有
该主题的记录。【主题ID——主题路径】映射数组中该主题ID对应的是一个空数组。
2. 删除【主题ID——主题路径】映射数组中该主题ID的数组项
3. 删除【主题ID——主题名】映射数组中该主题ID的数组项



## 条目操作
### 创建条目
1. 创建一个新条目时，需要选择其所属的条目大类和子类（如果没有则申请创建），
以及编写具体的条目内容
2. 为该条目ID添加若干个主题，记录每一个主题对应的主题路径
3. 根据选定的类别，【条目系统】对象中创建条目ID，记录对应的主题路径，记录条目内容
4. 在【主题路径——条目ID】Map，上述若干个主题路径分别都会在自己对应的条目数组里添加该条
目的ID

### 编辑条目主题
给一个条目添加或删除主题时，
1. 修改【条目系统】对象中该条目对应的主题路径
2. 修改【主题路径——条目ID】Map中相应主题路径对应的条目ID数组

### 删除条目
1. 删除【条目系统】对象中的该条目
2. 删除【主题路径——条目ID】Map中相应主题路径对应的条目ID



## 缓存
* 【主题树】对象
* 【主题ID——主题名】映射数组
* 【主题ID——主题路径】映射数组
* 【主题路径——条目ID】Map
