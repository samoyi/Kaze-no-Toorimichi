# 主题搜索算法


## 数据结构
* 【主题树】对象
* 【主题ID——主题名】映射数组
* 【主题ID——主题路径】映射数组
* 【主题路径——条目ID】Map(ES6 Map)
* 【条目系统】对象



## 【主题ID——主题名】映射数组
* 每个主题拥有一个唯一的数字ID，在【主题ID——主题名】映射数组中，数字ID作为数组索引，相
应的主题名作为对应的数组项值
* 同一个主题在主题树中可以出现在多个分支，但都拥有相同的ID



## 【主题ID——主题路径】映射数组
1. 因为同一个主题可以出现在主题树中的多个分支里，在搜索结果中也要按不同的类别分类，因此
需要记录每个主题有哪些分支。  
例如主题“淡路島”有“根主题-自然物-岛-淡路岛”的分支，也有“根主题-宗教体系-相关地域-淡路岛
”的分支。
2. 主题路径的存储是通过每个节点的主题ID。例如“根主题”、“自然物”、“岛”和“淡路岛”四个主题
的ID分别为`0`、`1`、`12`、`259`，则该条主题路径保存为数组`[0, 1, 12, 259]`
3. 主题ID作为该数组的索引，其对应的数组项是一个保存了该ID所有主题路径的数组。



## 【主题路径——条目ID】Map
主题路径作为键，值为该路径的主题相关的若干条目的ID组成的数组



## 【主题树】对象
* 包含完整的主题结构
* 节点包括主题名和主题ID



## 【条目系统】对象
### 【条目系统】对象结构
* 【条目系统】按照条目的大类和子类将条目分类
* 每个条目有唯一的ID
* 每一个条目会记录相关的主题路径
* 同一个子类的条目有统一的格式来展示条目内容

### 条目ID结构
条目ID分为三部分：大类ID、子类ID和类别内ID。以`0102435`为例说明：
* 大类ID：条目ID的前两位数，用来标志该条目属于哪个大类。例如`01`表示属于“书”大类
* 子类ID：大类ID之后的两位数，用来标志该条目属于哪个子类。例如`02`表示属于“期刊”子类
* 类别内ID：子类内具体的条目ID，以自然数的方式自增



## 主题操作
### 主题搜索
1. 输入一个主题名，在【主题ID——主题名】映射数组中找到对应的主题ID
2. 根据该主题ID，在【主题ID——主题路径】映射数组中找到该主题的若干主题路径数组
3. 在【主题路径——条目ID】映射中找到上述主题路径对应的的条目ID

### 新建主题
1. 将新建主题名push到【主题ID——主题名】
2. 为该新主题至少添加一个主题路径（见下面的“添加主题路径”）
3. 在【主题路径——条目ID】Map中为新加的若干主题路径分别创建一个值为空数组的数组项，等待
添加条目

### 添加主题路径
1. 将新建主题添加到【主题树】对象的合理位置上
2. 根据添加的位置获取主题路径数组，添加到【主题ID——主题路径】映射数组

### 修改主题名
1. 修改【主题树】对象中该主题ID对应的主题名
2. 【主题ID——主题名】映射数组中，获取主题ID并修改主题名

### 删除主题路径
1. 在主题数中删除该主题，并将被删除主题的子主题作为被删除主题父主题的子主题（爷孙变父子）
2. 在【主题ID——主题路径】映射数组中删除该主题路径
3. 在【主题路径——条目ID】Map中删除对应的路径和条目
4. 如果删除的是该主题的最后一条主题路径，则触发删除主题操作。见下文。

### 修改主题路径
1. 删除主题路径
2. 添加主题路径



### 删除主题
1. 当删除最后一条该主题的主题路径后，【主题树】对象和【主题路径——条目ID】Map中已经没有
该主题的记录。【主题ID——主题路径】映射数组中该主题ID对应的是一个空数组。
2. 删除【主题ID——主题路径】映射数组中该主题ID的数组项
3. 删除【主题ID——主题名】映射数组中该主题ID的数组项



## 条目操作
### 创建条目
1. 创建一个新条目时，需要选择其所属的条目大类和子类（如果没有则申请创建），
以及编写具体的条目内容
2. 为该条目ID添加若干个主题，记录每一个主题对应的主题路径
3. 根据选定的类别，【条目系统】对象中创建条目ID，记录对应的主题路径，记录条目内容
4. 在【主题路径——条目ID】Map，上述若干个主题路径分别都会在自己对应的条目数组里添加该条
目的ID

### 编辑条目主题
给一个条目添加或删除主题时，
1. 修改【条目系统】对象中该条目对应的主题路径
2. 修改【主题路径——条目ID】Map中相应主题路径对应的条目ID数组

### 删除条目
1. 删除【条目系统】对象中的该条目
2. 删除【主题路径——条目ID】Map中相应主题路径对应的条目ID



## 缓存
* 【主题树】对象
* 【主题ID——主题名】映射数组
* 【主题ID——主题路径】映射数组
* 【主题路径——条目ID】Map
